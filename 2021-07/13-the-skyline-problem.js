/**
 * @param {number[][]} buildings
 * @return {number[][]}
 */
// console.log(getSkyline([[2,13,10],[10,17,25],[12,20,14]]))
var getSkyline = function (buildings) {
  const res = [];
  const find = (target) => {
    let low = 0,
      high = res.length - 1;
    while (low <= high) {
      const mid = Math.floor((low + high) / 2)
      if (res[mid][0] < target) {
        low = mid + 1;
      } else if (res[mid][0] > target) {
        high = mid - 1;
      } else {
        return mid;
      }
    }
    return high
  }
  buildings.forEach(([x1, x2, h]) => {
    let i = find(x1),
      j = find(x2);
    const [x, y] = res[i] || [-1, 0];
    const [xj, yj] = res[j] || [Infinity, 0];

    if (xj !== x2 && h > yj) {
      res.splice(j + 1, 0, [x2, yj])
    }

    for (let k = i + 1; k <= j;) {
      if (res[k][1] < h && res[k][0] !== x2) {
        if (res[k - 1][1] === h) {
          res.splice(k, 1);
          j--;
        } else {
          res[k][1] = h;
          k++;
        }
      } else {
        k++;
      }
    }


    if (h > y) {
      if (x1 === x) {
        // if (i >= 1 && res[i - 1][1] !== h) {
        //   res[i][1] = h;
        // } else {
        //   res.splice(i, 1)
        // }
        if (res[i][1] !== h) {
          res[i][1] = h;
        }
        if (i >= 1 && res[i - 1][1] === h) {
          res.splice(i, 1)
        }
        if (res[i + 1] && res[i + 1][1] === h) {
          res.splice(i + 1, 1)
        }
      } else {
        if (res[i + 1] && res[i + 1][1] === h) {
          res.splice(i + 1, 1, [x1, h])
        } else {
          res.splice(i + 1, 0, [x1, h])
        }
      }

    }
  })
  return res;
};


// console.log(getSkyline([
//   [1, 20, 1],
//   [1, 21, 2],
//   [1, 22, 3]
// ]))
// console.log(getSkyline([
//   [0, 2147483647, 2147483647]
// ]))
// console.log(getSkyline([
//   [0, 2, 3],
//   [2, 5, 3]
// ]))
// console.log(getSkyline([
//   [2, 9, 10],
//   [3, 7, 15],
//   [5, 12, 12],
//   [15, 20, 10],
//   [19, 24, 8]
// ]))
// console.log(getSkyline([
//   [2, 13, 10],
//   [10, 17, 25],
//   [12, 20, 14]
// ]))

console.log(getSkyline([
  [1, 38, 219],
  [2, 19, 228],
  [2, 64, 106],
  [3, 80, 65],
  [3, 84, 8],
  [4, 12, 8],
  [4, 25, 14],
  [4, 46, 225],
  [4, 67, 187],
  [5, 36, 118],
  [5, 48, 211],
  [5, 55, 97],
  [6, 42, 92],
  [6, 56, 188],
  [7, 37, 42],
  [7, 49, 78],
  [7, 84, 163],
  [8, 44, 212],
  [9, 42, 125],
  [9, 85, 200],
  [9, 100, 74],
  [10, 13, 58],
  [11, 30, 179],
  [12, 32, 215],
  [12, 33, 161],
  [12, 61, 198],
  [13, 38, 48],
  [13, 65, 222],
  [14, 22, 1],
  [15, 70, 222],
  [16, 19, 196],
  [16, 24, 142],
  [16, 25, 176],
  [16, 57, 114],
  [18, 45, 1],
  [19, 79, 149],
  [20, 33, 53],
  [21, 29, 41],
  [23, 77, 43],
  [24, 41, 75],
  [24, 94, 20],
  [27, 63, 2],
  [31, 69, 58],
  [31, 88, 123],
  [31, 88, 146],
  [33, 61, 27],
  [35, 62, 190],
  [35, 81, 116],
  [37, 97, 81],
  [38, 78, 99],
  [39, 51, 125],
  [39, 98, 144],
  [40, 95, 4],
  [45, 89, 229],
  [47, 49, 10],
  [47, 99, 152],
  [48, 67, 69],
  [48, 72, 1],
  [49, 73, 204],
  [49, 77, 117],
  [50, 61, 174],
  [50, 76, 147],
  [52, 64, 4],
  [52, 89, 84],
  [54, 70, 201],
  [57, 76, 47],
  [58, 61, 215],
  [58, 98, 57],
  [61, 95, 190],
  [66, 71, 34],
  [66, 99, 53],
  [67, 74, 9],
  [68, 97, 175],
  [70, 88, 131],
  [74, 77, 155],
  [74, 99, 145],
  [76, 88, 26],
  [82, 87, 40],
  [83, 84, 132],
  [88, 99, 99]
]))